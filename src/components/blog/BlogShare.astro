---
import { Share2, Twitter, MessageCircle, Copy } from "lucide-react";
const shareText = Astro.props.shareText || "Check this out!";
const fullUrl = Astro.url.href; // fallback text
---

<div class="relative" data-share-text={shareText}>
  <button
    id="share-btn"
    class="flex items-center gap-2 px-4 py-2 border border-slate-200 rounded-md hover:bg-slate-50 transition-colors"
  >
    <Share2 className="h-4 w-4" />
    Share
  </button>

  <div
    id="share-dropdown"
    class="absolute left-5 mt-2 w-48 bg-white border border-slate-200 rounded-md shadow-lg z-50 hidden"
  >
    <div class="py-1">
      <a
        href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(fullUrl)}`}
        target="_blank"
        rel="noopener noreferrer"
        id="twitter-share"
        class="flex items-center w-full px-4 py-2 text-sm text-slate-700 hover:bg-slate-50"
      >
        <Twitter className="mr-2 h-4 w-4" /> Share on Twitter
      </a>
      <a
        href={`https://wa.me/?text=${encodeURIComponent(shareText + " " + fullUrl)}`}
        target="_blank"
        rel="noopener noreferrer"
        id="whatsapp-share"
        class="flex items-center w-full px-4 py-2 text-sm text-slate-700 hover:bg-slate-50"
      >
        <MessageCircle className="mr-2 h-4 w-4" /> Share on WhatsApp
      </a>
      <button
        id="copy-link"
        class="flex items-center w-full px-4 py-2 text-sm text-slate-700 hover:bg-slate-50"
      >
        <Copy className="mr-2 h-4 w-4" /> Copy Link
      </button>
    </div>
  </div>

  <div id="share-backdrop" class="fixed inset-0 z-40 hidden"></div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const currentUrl = window.location.href;

    const shareBtn = document.getElementById("share-btn");
    const dropdown = document.getElementById("share-dropdown");
    const backdrop = document.getElementById("share-backdrop");
    const twitterBtn = document.getElementById("twitter-share");
    const whatsappBtn = document.getElementById("whatsapp-share");
    const copyBtn = document.getElementById("copy-link");

    let open = false;

    const toggleDropdown = () => {
      open = !open;
      dropdown.classList.toggle("hidden", !open);
      backdrop.classList.toggle("hidden", !open);
    };

    const closeDropdown = () => {
      open = false;
      dropdown.classList.add("hidden");
      backdrop.classList.add("hidden");
    };

    shareBtn.addEventListener("click", toggleDropdown);
    backdrop.addEventListener("click", closeDropdown);

    twitterBtn.addEventListener("click", () => {
      closeDropdown();
    });

    whatsappBtn.addEventListener("click", () => {
      closeDropdown();
    });

    copyBtn.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(currentUrl);
        alert("Copied!");
      } catch {
        alert("Failed to copy");
      }
      closeDropdown();
    });
  });
</script>
