---
// src/pages/top-channels.astro
import { fetchTopChannels } from "../../data/topChannelsFetch";
const results = await fetchTopChannels();

import BaseLayout from "../../layout/BaseLayout.astro";
import HeaderWithForm from "../../components/HeaderWithForm.astro";
import Footer from "../../components/Footer.astro";
import CountryList from "../../components/CountriesList.astro";

function formatNumber(n) {
  return new Intl.NumberFormat("en", {
    notation: "compact",
    compactDisplay: "short",
    maximumFractionDigits: 1,
  }).format(n);
}

function formatIncomeNumber(num) {
  const rounded = Math.round(num * 10) / 10; // round to 1 decimal place
  return Number.isInteger(rounded) ? rounded.toString() : rounded.toFixed(1);
}

function formatUSD(amount) {
  if (amount < 1000) {
    return "$" + amount.toString();
  } else if (amount < 1000000) {
    return (
      "$" +
      new Intl.NumberFormat("en", {
        maximumFractionDigits: 0,
      }).format(amount)
    );
  } else if (amount < 1000000000) {
    const millionAmount = amount / 1000000;
    return "$" + formatIncomeNumber(millionAmount) + " million";
  } else {
    const billionAmount = amount / 1000000000;
    return "$" + formatIncomeNumber(billionAmount) + " billion";
  }
}
---

<BaseLayout
  pageTitle="Top 10 Highest-Earning YouTube Channels in 2025"
  pageDescription="See the top 10 YouTube channels ranked by estimated monthly income, views, and subscribers. Updated for 2025 — check who’s making the most money!"
  pageUrl="https://youtubersincome.com/top-youtube-channels"
>
  <HeaderWithForm />
  <section class="max-w-4xl mx-auto text-center pt-14 text-tPrimary">
    <div
      class="flex flex-col items-center mb-6 gap-2 sm:flex-row sm:justify-between"
    >
      <h2 class="text-2xl font-bold uppercase text-center sm:text-left">
        Top 10 YouTube Channels - 2025
      </h2>
      <!-- Country Dropdown -->
      <CountryList />
    </div>
    <!-- Description -->
    <p class="text-center text-gray-600 text-base">
      Discover the most popular YouTube creators by region and see how much they
      may earn from ad revenue. Start with the top global picks or filter by
      country.
    </p>
  </section>

  <section class="max-w-4xl mx-auto px-4 py-12 grid gap-6 sm:grid-cols-2">
    {
      results.map((channel, index) => (
        <a
          href={`/${channel.slug}`}
          class="bg-white p-5 rounded-2xl shadow-md hover:shadow-lg transition border border-gray-200 flex flex-col justify-between group"
        >
          <div>
            <div class="flex items-center gap-4 mb-4">
              <img
                src={`/images/${channel.slug}.webp`}
                alt={channel.name}
                width={64}
                height={64}
                class="w-16 h-16 rounded-full object-cover border border-gray-200"
                loading={index < 9 ? "eager" : "lazy"}
              />
              <div>
                <h2 class="text-lg font-bold leading-tight text-gray-800">
                  {index + 1}. {channel.name}
                </h2>
                <p class="text-xs text-gray-500">{channel.country}</p>
              </div>
            </div>

            <div class="space-y-2 text-sm text-gray-700">
              <p>
                <span class="font-medium text-gray-600">Subscribers:</span>{" "}
                <strong>{formatNumber(channel.subscriberCount)}</strong>
              </p>
              <p>
                <span class="font-medium text-gray-600">Total Views:</span>{" "}
                <strong>{formatNumber(channel.viewCount)}</strong>
              </p>
              <p>
                <span class="font-medium text-gray-600">Monthly Income:</span>{" "}
                <strong>{formatUSD(channel.monthlyIncome)}</strong>
              </p>
            </div>
          </div>

          <div class="mt-4">
            <span class="inline-block text-red-600 text-sm font-medium group-hover:underline">
              View Details →
            </span>
          </div>
        </a>
      ))
    }
  </section>

  <section class="max-w-4xl mx-auto px-4 py-8 text-sm text-gray-700">
    <h2 class="text-lg font-semibold mb-2">About This Ranking</h2>
    <p>
      This list is based on publicly available YouTube statistics and estimated
      ad revenue calculations. The actual income may vary based on sponsorships,
      merchandise, and other monetization methods.
    </p>
  </section>
  <Footer />
</BaseLayout>
